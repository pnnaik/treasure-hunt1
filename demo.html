<!doctype html>
<html lang="gu">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>demo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    .modal-centered {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 60vh;
    }

    .confetti {
      position: fixed;
      pointer-events: none;
      z-index: 1055;
    }

    .icon-btn {
      font-size: 2rem;
      margin: 5px;
    }
  </style>
</head>

<body class="p-4">

  <div class="container text-center">
    <h3>Ruko jara sabar karo</h3>
    <button id="mockScanBtn" class="btn btn-primary mt-3">Next</button>
    <div id="log" class="mt-3"></div>
  </div>

  <!-- 1я╕ПтГг Select Team -->
  <div id="teamModal" class="modal" tabindex="-1">
    <div class="modal-dialog modal-centered">
      <div class="modal-content text-center p-4">
        <h5>ркдркорк╛рк░рлА ркЯрлАрко рккрк╕ркВркж ркХрк░рлЛ ЁЯОп</h5>
        <div class="d-flex justify-content-around mt-3">
          <button class="btn btn-primary" onclick="selectTeam('blue')">ЁЯФ╡ Blue</button>
          <button class="btn btn-warning" onclick="selectTeam('yellow')">ЁЯЯб Yellow</button>
          <button class="btn btn-danger" onclick="selectTeam('red')">ЁЯФ┤ Red</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 2я╕ПтГг Song Play -->
  <div id="logoModal" class="modal" tabindex="-1">
    <div class="modal-dialog modal-centered">
      <div class="modal-content text-center p-4">
        <h5 id="songTitle">ЁЯО╡ ркЧрлАркд ркЪрк╛рк▓рлА рк░рк╣рлНркпрлБркВ ркЫрлЗ... ЁЯО╡</h5>
        <button id="nextBtn" class="btn btn-primary mt-3" disabled>Next</button>
      </div>
    </div>
  </div>

  <!-- 3я╕ПтГг Bell Number Input -->
  <div id="bellModal" class="modal" tabindex="-1">
    <div class="modal-dialog modal-centered">
      <div class="modal-content text-center p-4">
        <h5>ЁЯФФ Enter Number</h5>
        <input id="bellInput" type="text" class="form-control text-center" placeholder="YYYY MM DD" maxlength="8">
        <p id="bellHint" class="text-muted small mt-2"></p>
        <button id="bellNextBtn" class="btn btn-primary mt-3">Next тЖТ</button>
      </div>
    </div>
  </div>

  <!-- 4я╕ПтГг Car & Thief Icons -->
  <div id="iconModal" class="modal" tabindex="-1">
    <div class="modal-dialog modal-centered">
      <div class="modal-content text-center p-4">
        <h5></h5>
        <div>
          <span class="icon-btn">ЁЯЪЧ + </span>
          <span class="icon-btn">ЁЯХ╡я╕ПтАНтЩВя╕П</span>
        </div>
        <button id="iconNextBtn" class="btn btn-primary mt-3">Next тЖТ</button>
      </div>
    </div>
  </div>

  <!-- 5я╕ПтГг Car Number Input -->
  <div id="carModal" class="modal" tabindex="-1">
    <div class="modal-dialog modal-centered">
      <div class="modal-content text-center p-4">
        <h5>Enter Code</h5>
        <input id="carInput" type="text" class="form-control text-center" placeholder="Enter code" maxlength="10">
        <p id="carHint" class="text-muted small mt-2"></p>
        <button class="btn btn-success mt-3" onclick="checkCar()">Check</button>
      </div>
    </div>
  </div>

  <!-- ЁЯПЖ Winner Modal -->
  <div id="winnerModal" class="modal" tabindex="-1">
    <div class="modal-dialog modal-centered">
      <div class="modal-content text-center p-4">
        <h4>ркЕркнрк┐ркиркВркжрки ЁЯОЙ ркдркорлЗ Champion ркЫрлЛ! ЁЯПЖ</h4>
      </div>
    </div>
  </div>

  <!-- ЁЯФК Local Songs -->
  <audio id="blueSong" src="nikunj.mp3" preload="auto"></audio>
  <audio id="greenSong" src="ketul.mp3" preload="auto"></audio>
  <audio id="redSong" src="vinay.mp3" preload="auto"></audio>
  <audio id="winSound" src="win.mp3" preload="auto"></audio>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const correctBell = "17991104";
    const correctCar = "6169AA12JG"; //6169AA12JG  //GJ21AA9616

    const teamModal = new bootstrap.Modal(document.getElementById('teamModal'), { backdrop: 'static', keyboard: false });
    const logoModal = new bootstrap.Modal(document.getElementById('logoModal'), { backdrop: 'static', keyboard: false });
    const bellModal = new bootstrap.Modal(document.getElementById('bellModal'), { backdrop: 'static', keyboard: false });
    const iconModal = new bootstrap.Modal(document.getElementById('iconModal'), { backdrop: 'static', keyboard: false });
    const carModal = new bootstrap.Modal(document.getElementById('carModal'), { backdrop: 'static', keyboard: false });
    const wModal = new bootstrap.Modal(document.getElementById('winnerModal'), { backdrop: 'static', keyboard: false });

    let selectedTeam = "";
    let currentSong = null;

    document.getElementById('mockScanBtn').addEventListener('click', () => {
      log('QR Code Scanned тЬЕ');
      teamModal.show();
    });

    function selectTeam(team) {
      selectedTeam = team;
      teamModal.hide();
      logoModal.show();

      if (team === 'blue') { currentSong = document.getElementById('blueSong'); songTitle.innerText = "ЁЯФ╡ find the bell and get the clue..."; }
      if (team === 'yellow') { currentSong = document.getElementById('greenSong'); songTitle.innerText = "ЁЯЯб find the bell and get the clue..."; }
      if (team === 'red') { currentSong = document.getElementById('redSong'); songTitle.innerText = "ЁЯФ┤ find the bell and get the clue..."; }

      playSongBeforeNext();
    }

    function playSongBeforeNext() {
      nextBtn.disabled = true;
      currentSong.currentTime = 0;

      let playCount = 0; // ркХрлЗркЯрк▓рк╛ рк╡ркЦркд рк╡рк╛ркЧрлНркпрлБркВ ркдрлЗ ркЧркгрк╡рк╛ ркорк╛ркЯрлЗ

      function playAgain() {
        if (playCount < 3) { 
          playCount++;
          currentSong.currentTime = 0;
          currentSong.play().catch(() => { });

          currentSong.onended = () => {
            playAgain(); // ркЧрлАркд рккрлВрк░рлВркВ ркерк╛ркп ркПркЯрк▓рлЗ рклрк░рлА рк╡ркЧрк╛ркбрлЛ
          };
        } else {
          // ркдрлНрк░рлАркЬрлА рк╡рк╛рк░ ркмрк╛ркж Next ркмркЯрки рк╕ркХрлНрк░рк┐ркп ркХрк░рлЛ
          nextBtn.disabled = false;
          nextBtn.innerText = "Next тЖТ";
        }
      }

      playAgain(); // рк╢рк░рлВркЖркдркорк╛ркВ ркПркХ рк╡рк╛рк░ рк╡ркЧрк╛ркбрлЛ
    }

    // After song тЖТ show bell input
    nextBtn.addEventListener('click', () => {
      if (currentSong) currentSong.pause();
      logoModal.hide();
      bellModal.show();
    });

    // Bell check logic
    document.getElementById('bellNextBtn').addEventListener('click', () => {
      const num = document.getElementById('bellInput').value.trim();
      const hint = document.getElementById('bellHint');
      if (num === correctBell) {
        hint.innerText = "";
        bellModal.hide();
        iconModal.show();
      } else {
        hint.innerText = "тЭМ ркЦрлЛркЯрлЛ ркиркВркмрк░, рклрк░рлА рккрлНрк░ркпрк╛рк╕ ркХрк░рлЛ.";
      }
    });

    // Icons Next button
    document.getElementById('iconNextBtn').addEventListener('click', () => {
      iconModal.hide();
      carModal.show();
    });

    // Car number check
    function checkCar() {
      const car = document.getElementById('carInput').value.trim().toUpperCase();
      if (car === correctCar) {
        carModal.hide();
        document.getElementById('winSound').play().catch(() => { });
        launchConfetti();
        wModal.show();
      } else {
        document.getElementById('carHint').innerText = "тЭМ ркЦрлЛркЯрлЛ ркиркВркмрк░, рклрк░рлА рккрлНрк░ркпрк╛рк╕ ркХрк░рлЛ.";
      }
    }

    function launchConfetti() {
      for (let i = 0; i < 60; i++) {
        const el = document.createElement('div');
        el.className = 'confetti';
        el.style.left = (10 + Math.random() * 80) + '%';
        el.style.top = (10 + Math.random() * 30) + '%';
        el.style.width = '8px'; el.style.height = '12px';
        el.style.background = `hsl(${Math.random() * 360},80%,60%)`;
        el.style.opacity = 0.95;
        el.style.transform = `rotate(${Math.random() * 360}deg)`;
        el.style.transition = 'transform 1200ms linear, opacity 1200ms linear';
        document.body.appendChild(el);
        setTimeout(() => {
          el.style.transform = `translateY(${400 + Math.random() * 300}px) rotate(${Math.random() * 720}deg)`;
          el.style.opacity = '0';
        }, 20);
        setTimeout(() => el.remove(), 1400);
      }
    }

    function log(msg) {
      const l = document.getElementById('log');
      const p = document.createElement('div');
      p.innerText = `[${new Date().toLocaleTimeString()}] ${msg}`;
      l.prepend(p);
    }
  </script>
</body>

</html>